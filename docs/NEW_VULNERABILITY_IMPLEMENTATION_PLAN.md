# Implementation Plan: Missing Vulnerabilities from MASTER_PROMPT.md

## Overview
This plan implements the missing vulnerabilities from the REQUIRED VULNERABILITY CATEGORIES section.

---

## Current Status Analysis

### Already Implemented ✅
1. **Stored XSS (in product reviews)** - `review.controller.js` - ✅ DONE
2. **Reflected XSS (in address section)** - `user.controller.js` - previewAddress - ✅ DONE
3. **SQL injection (in product)** - `product.controller.js` - keyword search - ✅ DONE
4. **SQL injection (in order history - blind)** - `order.controller.js` - orderNumber - ✅ DONE
5. **SSTI (in vendor profile)** - `vendor.controller.js` - renderProfileBio - ✅ DONE
6. **OAuth vulnerabilities** - `oauth.controller.js` - ✅ DONE
7. **Unrestricted file upload (in product image)** - `product.controller.js` - ✅ DONE

### Implemented in This Phase ✅

---

## Phase 1: SQL Injection in Invoice Endpoint ✅ COMPLETED

### Implementation
- **File**: `backend/src/controllers/export.controller.js`
- **Endpoint**: `GET /api/v1/export/invoices/:orderId`
- **Vulnerability**: Added `filter` query parameter that uses raw SQL
- **Comment**: `// VULNERABLE: SQL injection`

---

## Phase 2: SQL Injection in Product Delete ✅ COMPLETED

### Implementation
- **File**: `backend/src/controllers/product.controller.js`
- **Endpoint**: `DELETE /api/v1/products/:id`
- **Vulnerability**: Added `condition` query parameter that uses raw SQL
- **Comment**: `// VULNERABLE: SQL injection`

---

## Phase 3: SQL Injection in Product Update ✅ COMPLETED

### Implementation
- **File**: `backend/src/controllers/product.controller.js`
- **Endpoint**: `PUT /api/v1/products/:id`
- **Vulnerability**: Added `rawSql` body parameter that allows raw SQL execution
- **Comment**: `// VULNERABLE: SQL injection`

---

## Phase 4: SSTI in User Profile ✅ COMPLETED

### Implementation
- **File**: `backend/src/controllers/user.controller.js`
- **New Endpoint**: `GET /api/v1/users/profile/render`
- **Route**: `backend/src/routes/user.routes.js`
- **Vulnerability**: Template injection via bio field using eval()
- **Comment**: `// VULNERABLE: SSTI`

---

## Phase 5: MIME Bypass in Product Image Upload ✅ ALREADY DONE

### Implementation
- **File**: `backend/src/utils/upload.js`
- **Status**: Already vulnerable - fileFilter accepts all files without validation
- **Comment**: `// VULNERABLE: No file type validation`

---

## Phase 6: OAuth redirect_uri Validation Bypass ✅ COMPLETED

### Implementation
- **File**: `backend/src/controllers/oauth.controller.js`
- **Endpoint**: `GET /api/v1/auth/google/callback`
- **Vulnerability**: Added `redirect_uri` query parameter override
- **Comment**: `// VULNERABLE: redirect_uri validation bypass`

---

## Summary

### Files Modified:
1. `backend/src/controllers/export.controller.js` - Added SQL injection in invoice
2. `backend/src/controllers/product.controller.js` - Added SQL injection in delete/update
3. `backend/src/controllers/user.controller.js` - Added SSTI in user profile render
4. `backend/src/routes/user.routes.js` - Added route for user profile render
5. `backend/src/controllers/oauth.controller.js` - Added redirect_uri bypass

### Vulnerabilities Now Implemented:
- [x] SQL injection in invoice endpoint via filter parameter
- [x] SQL injection in product delete via condition query parameter  
- [x] SQL injection in product update via rawSql body parameter
- [x] SSTI in user profile via /users/profile/render endpoint
- [x] MIME bypass in product image upload (already present)
- [x] OAuth redirect_uri bypass via query parameter

### Not Implemented (Frontend Only):
- DOM XSS (in client-side code) - Frontend vulnerability, not backend

